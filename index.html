<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily German Learning</title>
    <meta name="description" content="Master German with themed articles, vocabulary, and real-world scenarios">
    <style>
        /* --- CSS Variables for Theming --- */
        :root {
            --bg-color: #f8f9fa;
            --card-bg-color: white;
            --text-color: #333;
            --header-text-color: #2c3e50;
            --subtle-text-color: #6c757d;
            --border-color: #dee2e6;
            --shadow-color: rgba(0,0,0,0.05);
            --primary-accent: #007bff;
            --secondary-accent: #28a745;
        }

        body.dark-theme {
            --bg-color: #121212;
            --card-bg-color: #1e1e1e;
            --text-color: #e0e0e0;
            --header-text-color: #ffffff;
            --subtle-text-color: #adb5bd;
            --border-color: #444;
            --shadow-color: rgba(0,0,0,0.2);
        }
        /* --- End Theming Variables --- */

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: var(--card-bg-color);
            border-radius: 10px;
            box-shadow: 0 2px 10px var(--shadow-color);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 15px;
        }

        header h1 {
            color: var(--header-text-color);
            font-size: 2em;
            margin: 0;
            text-align: left;
            flex-grow: 1;
        }

        header p {
            color: var(--subtle-text-color);
            font-size: 1.1em;
            width: 100%;
            text-align: center;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        #theme-nav {
            display: block;
        }

        .theme-select-dropdown {
            padding: 8px 12px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg-color);
            color: var(--text-color);
            font-family: 'Georgia', serif;
            font-size: 14px;
            cursor: pointer;
            min-width: 180px;
        }

        /* --- Theme Switch Styles --- */
        .theme-switch-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .theme-switch-wrapper span {
            font-size: 14px;
            color: var(--subtle-text-color);
        }

        .theme-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }

        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-accent);
        }

        input:checked + .slider:before {
            transform: translateX(22px);
        }
        /* --- End Theme Switch Styles --- */

        .search-container {
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 20px;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg-color);
            color: var(--text-color);
            border-radius: 25px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-accent);
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

        #article-display {
            background: var(--card-bg-color);
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px var(--shadow-color);
        }

        .german-text {
            font-size: 18px;
            line-height: 1.8;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--bg-color);
            border-left: 4px solid var(--primary-accent);
            border-radius: 5px;
        }

        .english-text {
            font-size: 16px;
            color: var(--subtle-text-color);
            font-style: italic;
            margin-bottom: 20px;
            padding: 15px;
            background: #fff3cd;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
        }

        body.dark-theme .english-text {
            background: #3e3829;
        }

        .vocabulary-section, .phrases-section, .quotes-section, .conversation-section {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid transparent;
        }

        .vocabulary-section { background-color: #e8f4fd; border-left-color: #007bff; }
        .phrases-section { background-color: #e8f5e8; border-left-color: #28a745; }
        .quotes-section { background-color: #fff5e6; border-left-color: #fd7e14; font-style: italic; }
        .conversation-section { background-color: #f8e6ff; border-left-color: #6f42c1; }

        body.dark-theme .vocabulary-section { background-color: #2a333d; }
        body.dark-theme .phrases-section { background-color: #2a352c; }
        body.dark-theme .quotes-section { background-color: #3e332a; }
        body.dark-theme .conversation-section { background-color: #342a3d; }

        .vocabulary-section strong, .phrases-section strong, .quotes-section strong, .conversation-section strong {
            display: block;
            margin-bottom: 8px;
            font-size: 16px;
            color: var(--header-text-color);
        }

        .vocabulary-section div, .phrases-section div, .quotes-section div, .conversation-section div {
            font-size: 15px;
            line-height: 1.5;
        }

        .nav-buttons {
            text-align: center;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-btn {
            display: inline-block;
            padding: 10px 20px;
            background: var(--primary-accent);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }

        .nav-btn:hover {
            background: #0056b3;
        }

        .metadata {
            background: var(--bg-color);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            border-left: 4px solid var(--subtle-text-color);
        }

        #loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: var(--subtle-text-color);
        }

        #article-info {
            text-align: center;
            margin-top: 20px;
        }

        #article-info small {
            color: var(--subtle-text-color);
            font-size: 13px;
        }

        .search-results {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 10px;
            margin-top: -10px;
            margin-bottom: 20px;
            border-radius: 8px;
            text-align: center;
        }

        body.dark-theme .search-results {
            background-color: #2a352c;
            border-color: #28a745;
            color: #a3d9b1;
        }

        .error-message {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            text-align: center;
        }

        body.dark-theme .error-message {
            background-color: #4a2c2c;
            border-color: #dc3545;
            color: #f8d7da;
        }

        @media (max-width: 768px) {
            .header-top {
                flex-direction: column;
                text-align: center;
            }
            
            header h1 {
                text-align: center;
            }
            
            .nav-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .nav-btn {
                width: 100%;
                max-width: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <h1>Daily German Learning</h1>
                <div class="header-controls">
                    <nav id="theme-nav">
                        <select id="theme-select" class="theme-select-dropdown">
                            <option value="">Browse by Theme</option>
                        </select>
                    </nav>
                    <!-- Modern Theme Toggle Switch -->
                    <div class="theme-switch-wrapper">
                        <span>🌞</span>
                        <label class="theme-switch" for="theme-checkbox">
                            <input type="checkbox" id="theme-checkbox" />
                            <div class="slider"></div>
                        </label>
                        <span>🌙</span>
                    </div>
                </div>
            </div>
            <p>Master German with themed articles and real-world scenarios</p>
        </header>
        
        <div class="search-container" id="search-container" style="display: none;">
            <input 
                type="text" 
                id="search-input" 
                class="search-input" 
                placeholder="Search articles, themes, or vocabulary..."
            >
        </div>
        
        <main id="main-content">
            <div id="loading">Loading today's article...</div>
            <div id="article-display" style="display: none;"></div>
        </main>
        
        <div class="nav-buttons" id="nav-buttons" style="display: none;">
            <button class="nav-btn" onclick="navigateArticle('previous')">← Previous Article</button>
            <button class="nav-btn" onclick="resetSearch()">🔄 Show All / Latest</button>
            <button class="nav-btn" onclick="navigateArticle('next')">Next Article →</button>
        </div>
        
        <div id="article-info" style="display: none;">
            <p><small>Article <span id="current-article-number">1</span> of <span id="total-articles">0</span> | 
            <span id="current-date"></span></small></p>
        </div>
    </div>
    
    <script>
        // Your Google Sheets ID
        const SHEET_ID = '1WbU27bSvjaHWCdCl7deU9-iEBTCmlSZe8l99-ppxfS8';
        const SHEET_NAME = 'Sheet1';
        const API_KEY = 'YOUR_NEW_SECURE_API_KEY'; // IMPORTANT: Replace with a new, restricted API key

        // Global variables
        let articles = [];
        let filteredArticles = [];
        let currentArticle = null;

        // --- Theme Toggle Logic ---
        const themeToggle = document.getElementById('theme-checkbox');
        
        // Apply saved theme on load
        function initializeTheme() {
            // For demo purposes, we'll use a simple variable instead of localStorage
            // In your actual implementation, replace this with localStorage
            let currentTheme = 'light-theme'; // Default theme
            
            // Check if dark theme should be applied
            if (currentTheme === 'dark-theme') {
                document.body.classList.add('dark-theme');
                themeToggle.checked = true;
            }
        }

        // Theme toggle event listener
        function setupThemeToggle() {
            if (themeToggle) {
                themeToggle.addEventListener('change', function() {
                    if (this.checked) {
                        document.body.classList.add('dark-theme');
                        // localStorage.setItem('theme', 'dark-theme');
                    } else {
                        document.body.classList.remove('dark-theme');
                        // localStorage.setItem('theme', 'light-theme');
                    }
                });
            }
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            initializeTheme();
            setupThemeToggle();
            setupSearchInput();
            loadArticles();
        });

        // Setup search input event listener
        function setupSearchInput() {
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter') {
                        searchArticles(this.value);
                    }
                });
            }
        }

        // Load articles from Google Sheets
        async function loadArticles() {
            try {
                // For demo purposes, we'll use sample data
                // In your actual implementation, uncomment the API call below
                
                /*
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_NAME}?key=${API_KEY}`;
                const response = await fetch(url);
                if (!response.ok) throw new Error(`API request failed. Check API Key/Sheet ID.`);
                
                const data = await response.json();
                if (data.values && data.values.length > 1) {
                    articles = parseSheetData(data.values);
                } else {
                    throw new Error('No data found in the sheet.');
                }
                */
                
                // Demo data
                articles = [
                    {
                        DATE: '2025-07-02',
                        THEME: 'Travel',
                        GERMAN_ARTICLE: 'Heute fahre ich nach Berlin. Die Stadt ist sehr groß und hat viele interessante Museen. Ich freue mich auf die Reise.',
                        ENGLISH_TRANSLATION: 'Today I am traveling to Berlin. The city is very large and has many interesting museums. I am looking forward to the trip.',
                        VOCABULARY_USED: '<strong>fahren</strong> - to drive/travel<br><strong>groß</strong> - big/large<br><strong>Museum</strong> - museum<br><strong>Reise</strong> - trip/journey',
                        PHRASE_IDIOM: '<strong>sich freuen auf</strong> - to look forward to<br><strong>Es ist soweit</strong> - It\'s time/The time has come',
                        QUOTE_JOKE: '"Reisen ist die einzige Sache, die du kaufst und die dich reicher macht." - Travel is the only thing you buy that makes you richer.',
                        CONVERSATION_TIME: '<strong>A:</strong> Wohin fährst du?<br><strong>B:</strong> Ich fahre nach Berlin.<br><strong>A:</strong> Wie lange bleibst du dort?<br><strong>B:</strong> Drei Tage.',
                        GRAMMAR_LESSON: 'Modal verb "fahren" conjugation',
                        Status: 'Published'
                    },
                    {
                        DATE: '2025-07-01',
                        THEME: 'Food',
                        GERMAN_ARTICLE: 'Ich koche gerne deutsche Gerichte. Heute mache ich Schnitzel mit Kartoffeln. Das Essen schmeckt sehr gut.',
                        ENGLISH_TRANSLATION: 'I like to cook German dishes. Today I am making schnitzel with potatoes. The food tastes very good.',
                        VOCABULARY_USED: '<strong>kochen</strong> - to cook<br><strong>Gericht</strong> - dish<br><strong>Schnitzel</strong> - schnitzel<br><strong>schmecken</strong> - to taste',
                        PHRASE_IDIOM: '<strong>guten Appetit</strong> - enjoy your meal<br><strong>Es schmeckt mir</strong> - I like the taste',
                        QUOTE_JOKE: '"Man ist, was man isst." - You are what you eat.',
                        CONVERSATION_TIME: '<strong>A:</strong> Was kochst du heute?<br><strong>B:</strong> Schnitzel mit Kartoffeln.<br><strong>A:</strong> Das klingt lecker!',
                        GRAMMAR_LESSON: 'Present tense with "gerne"',
                        Status: 'Published'
                    }
                ];
                
                if (articles.length > 0) {
                    filteredArticles = [...articles];
                    displayLatestArticle();
                    setupThemeNavigation();
                    setupUI();
                } else {
                    showError('No "Published" articles found.');
                }
            } catch (error) {
                console.error('Error loading articles:', error);
                showError('Error loading content. Please check your API configuration.');
            }
        }

        // Parse sheet data into a usable format
        function parseSheetData(rows) {
            const headers = rows[0].map(h => h.trim().replace(/\s/g, '_'));
            const data = [];
            const statusIndex = headers.indexOf('Status');

            for (let i = rows.length - 1; i > 0; i--) {
                const row = rows[i];
                if (row[statusIndex] && row[statusIndex].trim() === 'Published') {
                    let article = {};
                    headers.forEach((header, index) => {
                        article[header] = row[index] || '';
                    });
                    data.push(article);
                }
            }
            return data;
        }

        // Display the most recent article by default
        function displayLatestArticle() {
            if (articles.length > 0) {
                displayArticle(articles[0]);
            }
        }

        // Display an article
        function displayArticle(article) {
            currentArticle = article;
            const displayContainer = document.getElementById('article-display');
            
            const displayHTML = `
                <div class="metadata">
                    <strong>Theme:</strong> ${article.THEME} | 
                    <strong>Grammar Focus:</strong> ${article.GRAMMAR_LESSON.replace(/\n/g, '<br>')} |
                    <strong>Date:</strong> ${article.DATE}
                </div>
                <div class="german-text">${article.GERMAN_ARTICLE}</div>
                <div class="english-text">${article.ENGLISH_TRANSLATION.replace(/\n/g, '<br>')}</div>
                <div class="vocabulary-section"><strong>🎯 Key Vocabulary:</strong><div>${article.VOCABULARY_USED}</div></div>
                <div class="phrases-section"><strong>💬 Phrases & Idioms:</strong><div>${article.PHRASE_IDIOM}</div></div>
                <div class="quotes-section"><strong>😄 Quote & Joke:</strong><div>${article.QUOTE_JOKE}</div></div>
                <div class="conversation-section"><strong>🗣️ Conversation Time:</strong><div>${article.CONVERSATION_TIME}</div></div>
            `;
            
            displayContainer.innerHTML = displayHTML;
            displayContainer.style.display = 'block';
            document.getElementById('loading').style.display = 'none';
            
            updateArticleCounter();
        }

        // Show error message
        function showError(message) {
            const loadingElement = document.getElementById('loading');
            loadingElement.innerHTML = `<div class="error-message">${message}</div>`;
        }

        // Set up UI elements after articles load
        function setupUI() {
            document.getElementById('search-container').style.display = 'block';
            document.getElementById('nav-buttons').style.display = 'block';
            document.getElementById('article-info').style.display = 'block';
        }

        // Set up theme navigation dropdown
        function setupThemeNavigation() {
            const themeSelect = document.getElementById('theme-select');
            const themes = [...new Set(articles.map(article => article.THEME))];
            
            // Clear previous options except the first one
            themeSelect.innerHTML = '<option value="">Browse by Theme</option>';
            
            themes.forEach(theme => {
                const option = document.createElement('option');
                option.value = theme;
                option.textContent = theme;
                themeSelect.appendChild(option);
            });

            // Add event listener
            themeSelect.addEventListener('change', function() {
                showArticlesByTheme(this.value);
            });
        }

        // Show articles by theme from dropdown
        function showArticlesByTheme(theme) {
            if (!theme) {
                resetSearch();
                return;
            }
            filteredArticles = articles.filter(article => article.THEME === theme);
            if (filteredArticles.length > 0) {
                displayArticle(filteredArticles[0]);
            }
        }

        // Navigate to next/previous article
        function navigateArticle(direction) {
            const currentIndex = filteredArticles.findIndex(a => a.DATE === currentArticle.DATE && a.THEME === currentArticle.THEME);
            if (currentIndex === -1) return;

            let newIndex;
            if (direction === 'next') {
                newIndex = (currentIndex - 1 + filteredArticles.length) % filteredArticles.length;
            } else {
                newIndex = (currentIndex + 1) % filteredArticles.length;
            }
            displayArticle(filteredArticles[newIndex]);
        }

        // Search articles by keyword
        function searchArticles(keyword) {
            const searchInput = document.getElementById('search-input');
            const searchTerm = keyword || searchInput.value;
            if (!searchTerm.trim()) {
                resetSearch();
                return;
            }
            
            const searchResults = articles.filter(article => 
                Object.values(article).some(value => String(value).toLowerCase().includes(searchTerm.toLowerCase()))
            );
            
            if (searchResults.length > 0) {
                filteredArticles = searchResults;
                displayArticle(searchResults[0]);
                showSearchResults(searchResults.length, searchTerm);
            } else {
                alert(`No articles found for "${searchTerm}"`);
            }
        }

        // Show search results notification
        function showSearchResults(count, keyword) {
            const metadata = document.querySelector('.metadata');
            if (metadata) {
                const existingSearch = document.querySelector('.search-results');
                if (existingSearch) existingSearch.remove();

                const searchInfo = document.createElement('div');
                searchInfo.className = 'search-results';
                searchInfo.innerHTML = `<small>🔍 Found ${count} result(s) for "${keyword}" | <a href="#" onclick="event.preventDefault(); resetSearch();">Show all articles</a></small>`;
                metadata.insertAdjacentElement('afterend', searchInfo);
            }
        }

        // Reset search to show all articles
        function resetSearch() {
            filteredArticles = [...articles];
            displayLatestArticle();
            const searchResults = document.querySelector('.search-results');
            if (searchResults) searchResults.remove();
            const searchInput = document.getElementById('search-input');
            if (searchInput) searchInput.value = '';
            const themeSelect = document.getElementById('theme-select');
            if (themeSelect) themeSelect.value = '';
        }

        // Update article counter and info
        function updateArticleCounter() {
            const currentIndex = filteredArticles.findIndex(a => a.DATE === currentArticle.DATE && a.THEME === currentArticle.THEME);
            document.getElementById('current-article-number').textContent = currentIndex + 1;
            document.getElementById('total-articles').textContent = filteredArticles.length;
            document.getElementById('current-date').textContent = currentArticle.DATE;
        }

        // Add keyboard navigation
        document.addEventListener('keydown', function(event) {
            const searchInput = document.getElementById('search-input');
            if (document.activeElement !== searchInput) {
                if (event.key === 'ArrowLeft') navigateArticle('previous');
                if (event.key === 'ArrowRight') navigateArticle('next');
                if (event.key === 'Home') {
                    event.preventDefault();
                    resetSearch();
                }
            }
        });
    </script>
</body>
</html>
