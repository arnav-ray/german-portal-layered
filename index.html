<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Daily German Learning</title>
Â  Â  <meta name="description" content="Master German with themed articles, vocabulary, and interactive exercises">
Â  Â  <style>
Â  Â  Â  Â  /* --- CSS Variables for Theming --- */
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --bg-color: #f8f9fa;
Â  Â  Â  Â  Â  Â  --card-bg-color: white;
Â  Â  Â  Â  Â  Â  --text-color: #333;
Â  Â  Â  Â  Â  Â  --header-text-color: #2c3e50;
Â  Â  Â  Â  Â  Â  --subtle-text-color: #6c757d;
Â  Â  Â  Â  Â  Â  --border-color: #dee2e6;
Â  Â  Â  Â  Â  Â  --shadow-color: rgba(0,0,0,0.05);
Â  Â  Â  Â  Â  Â  --primary-accent: #007bff;
Â  Â  Â  Â  Â  Â  --secondary-accent: #28a745;
Â  Â  Â  Â  Â  Â  --danger-accent: #dc3545;
Â  Â  Â  Â  Â  Â  --success-accent: #28a745;
Â  Â  Â  Â  Â  Â  --modal-overlay-color: rgba(0, 0, 0, 0.6);
Â  Â  Â  Â  }

Â  Â  Â  Â  body.dark-theme {
Â  Â  Â  Â  Â  Â  --bg-color: #121212;
Â  Â  Â  Â  Â  Â  --card-bg-color: #1e1e1e;
Â  Â  Â  Â  Â  Â  --text-color: #e0e0e0;
Â  Â  Â  Â  Â  Â  --header-text-color: #ffffff;
Â  Â  Â  Â  Â  Â  --subtle-text-color: #adb5bd;
Â  Â  Â  Â  Â  Â  --border-color: #444;
Â  Â  Â  Â  Â  Â  --shadow-color: rgba(0,0,0,0.2);
Â  Â  Â  Â  Â  Â  --modal-overlay-color: rgba(0, 0, 0, 0.7);
Â  Â  Â  Â  }
Â  Â  Â  Â  /* --- End Theming Variables --- */

Â  Â  Â  Â  * { margin: 0; padding: 0; box-sizing: border-box; }
Â  Â  Â  Â  body { font-family: 'Georgia', serif; line-height: 1.6; color: var(--text-color); background-color: var(--bg-color); transition: background-color 0.3s ease, color 0.3s ease; }
Â  Â  Â  Â  .container { max-width: 800px; margin: 0 auto; padding: 20px; }
Â  Â  Â  Â  header { text-align: center; margin-bottom: 20px; padding: 20px; background: var(--card-bg-color); border-radius: 10px; box-shadow: 0 2px 10px var(--shadow-color); }
Â  Â  Â  Â  .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; flex-wrap: wrap; gap: 15px; }
Â  Â  Â  Â  header h1 { color: var(--header-text-color); font-size: 2em; margin: 0; text-align: left; flex-grow: 1; }
Â  Â  Â  Â  header p { color: var(--subtle-text-color); font-size: 1.1em; width: 100%; text-align: center; }
Â  Â  Â  Â  .header-controls { display: flex; align-items: center; gap: 15px; }

Â  Â  Â  Â  /* --- Settings Button --- */
Â  Â  Â  Â  #settings-btn { background: transparent; border: none; font-size: 24px; cursor: pointer; color: var(--subtle-text-color); transition: transform 0.3s ease; }
Â  Â  Â  Â  #settings-btn:hover { transform: rotate(45deg); }

Â  Â  Â  Â  /* --- Main Navigation Tabs --- */
Â  Â  Â  Â  #main-nav { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
Â  Â  Â  Â  .nav-tab { padding: 10px 20px; font-size: 16px; cursor: pointer; border: none; background: transparent; color: var(--subtle-text-color); border-bottom: 2px solid transparent; transition: all 0.3s ease; }
Â  Â  Â  Â  .nav-tab.active { color: var(--primary-accent); border-bottom-color: var(--primary-accent); font-weight: bold; }
Â  Â  Â  Â  .nav-tab:hover { color: var(--primary-accent); }

Â  Â  Â  Â  /* --- Content Pages --- */
Â  Â  Â  Â  .page { display: none; }
Â  Â  Â  Â  .page.active { display: block; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* --- Article Page Styles --- */
Â  Â  Â  Â  #level-navigation { background: var(--card-bg-color); padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px var(--shadow-color); margin-bottom: 20px; }
Â  Â  Â  Â  .level-header { background: var(--bg-color); padding: 15px; border-radius: 8px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: background-color 0.2s ease; margin-bottom: 5px;}
Â  Â  Â  Â  .level-header:hover { background-color: #e9ecef; }
Â  Â  Â  Â  body.dark-theme .level-header:hover { background-color: #343a40; }
Â  Â  Â  Â  .level-header h3 { margin: 0; color: var(--header-text-color); }
Â  Â  Â  Â  .level-header .toggle-icon { font-weight: bold; transition: transform 0.3s ease; }
Â  Â  Â  Â  .level-header.active .toggle-icon { transform: rotate(90deg); }
Â  Â  Â  Â  .theme-list { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out, padding 0.4s ease-out; padding: 0 15px; display: flex; flex-wrap: wrap; gap: 10px; }
Â  Â  Â  Â  .theme-list.active { max-height: 500px; padding: 15px 15px 5px 15px; }
Â  Â  Â  Â  .theme-button { display: inline-block; padding: 8px 15px; background: var(--secondary-accent); color: white; text-decoration: none; border-radius: 20px; font-size: 14px; border: none; cursor: pointer; transition: all 0.3s ease; }
Â  Â  Â  Â  .theme-button:hover { background: #218838; transform: translateY(-1px); }
Â  Â  Â  Â  .search-container { margin-bottom: 20px; }
Â  Â  Â  Â  .search-input { width: 100%; padding: 12px 20px; border: 1px solid var(--border-color); background-color: var(--card-bg-color); color: var(--text-color); border-radius: 25px; font-size: 16px; transition: all 0.3s ease; }
Â  Â  Â  Â  .search-input:focus { outline: none; border-color: var(--primary-accent); box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25); }
Â  Â  Â  Â  #article-display-container { background: var(--card-bg-color); padding: 30px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px var(--shadow-color); }
Â  Â  Â  Â  .sub-nav { display: flex; border-bottom: 1px solid var(--border-color); margin-bottom: 20px; }
Â  Â  Â  Â  .sub-nav-tab { padding: 10px 20px; font-size: 16px; cursor: pointer; border: none; background: transparent; color: var(--subtle-text-color); border-bottom: 3px solid transparent; margin-bottom: -1px; transition: all 0.3s ease; }
Â  Â  Â  Â  .sub-nav-tab.active { color: var(--primary-accent); border-bottom-color: var(--primary-accent); font-weight: bold; }
Â  Â  Â  Â  .sub-page { display: none; }
Â  Â  Â  Â  .sub-page.active { display: block; }
Â  Â  Â  Â  .german-text { font-size: 18px; line-height: 1.8; margin-bottom: 30px; padding: 20px; background: var(--bg-color); border-left: 4px solid var(--primary-accent); border-radius: 5px; }
Â  Â  Â  Â  .english-text { font-size: 16px; color: var(--subtle-text-color); font-style: italic; margin-bottom: 20px; padding: 15px; background: #fff3cd; border-radius: 5px; border-left: 4px solid #ffc107; }
Â  Â  Â  Â  body.dark-theme .english-text { background: #3e3829; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* --- Grammar Color Coding --- */
Â  Â  Â  Â  .german-text span { cursor: pointer; transition: background-color 0.2s ease-in-out; padding: 1px 2px; border-radius: 3px; }
Â  Â  Â  Â  .german-text span:hover { background-color: #d0eaff; }
Â  Â  Â  Â  body.dark-theme .german-text span:hover { background-color: #003c7a; }
Â  Â  Â  Â  .noun-m { color: #007bff; font-weight: bold; } .noun-f { color: #dc3545; font-weight: bold; } .noun-n { color: #28a745; font-weight: bold; }
Â  Â  Â  Â  .verb { color: #6f42c1; text-decoration: underline; } .adjective { color: #fd7e14; } .adverb { color: #6c757d; font-style: italic; }
Â  Â  Â  Â  .preposition { color: #E91E63; } .conjunction { color: #20c997; } .pronoun { color: #ffc107; } .article { color: #17a2b8; font-weight: bold; }
Â  Â  Â  Â  .punctuation { color: var(--subtle-text-color); }
Â  Â  Â  Â  /* --- End Grammar Coding --- */

Â  Â  Â  Â  .article-section { margin-top: 20px; padding: 15px; border-radius: 8px; border-left: 4px solid transparent; }
Â  Â  Â  Â  .vocabulary-section { background-color: #e8f4fd; border-left-color: #007bff; }
Â  Â  Â  Â  .grammar-section { background-color: #e8f5e8; border-left-color: #28a745; }
Â  Â  Â  Â  .phrases-section { background-color: #fdf5e6; border-left-color: #fd7e14; }
Â  Â  Â  Â  .quotes-section { background-color: #f8e6ff; border-left-color: #6f42c1; font-style: italic; }
Â  Â  Â  Â  .conversation-section { background-color: #e6f9f1; border-left-color: #20c997; }
Â  Â  Â  Â  body.dark-theme .vocabulary-section { background-color: #2a333d; }
Â  Â  Â  Â  body.dark-theme .grammar-section { background-color: #2a352c; }
Â  Â  Â  Â  body.dark-theme .phrases-section { background-color: #3e3829; }
Â  Â  Â  Â  body.dark-theme .quotes-section { background-color: #342a3d; }
Â  Â  Â  Â  body.dark-theme .conversation-section { background-color: #2a3a34; }
Â  Â  Â  Â  .article-section strong { display: block; margin-bottom: 8px; font-size: 16px; color: var(--header-text-color); }
Â  Â  Â  Â  .article-section div { font-size: 15px; line-height: 1.5; }
Â  Â  Â  Â  .nav-buttons { text-align: center; margin-bottom: 20px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
Â  Â  Â  Â  .nav-btn { display: inline-block; padding: 10px 20px; background: var(--primary-accent); color: white; border: none; border-radius: 25px; cursor: pointer; font-size: 14px; transition: background-color 0.3s ease; }
Â  Â  Â  Â  .nav-btn:hover { background: #0056b3; }
Â  Â  Â  Â  .metadata { background: var(--bg-color); padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; border-left: 4px solid var(--subtle-text-color); }
Â  Â  Â  Â  #loading { text-align: center; padding: 50px; font-size: 18px; color: var(--subtle-text-color); }
Â  Â  Â  Â  #article-info { text-align: center; margin-top: 20px; }
Â  Â  Â  Â  #article-info small { color: var(--subtle-text-color); font-size: 13px; }
Â  Â  Â  Â  #audio-player-container { display: flex; gap: 10px; align-items: center; background-color: var(--bg-color); padding: 10px 15px; border-radius: 25px; margin-bottom: 20px; width: fit-content; }
Â  Â  Â  Â  .audio-btn { background: var(--primary-accent); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s ease; }
Â  Â  Â  Â  .audio-btn:hover { background: #0056b3; }
Â  Â  Â  Â  #audio-status { font-size: 14px; color: var(--subtle-text-color); font-weight: bold; }
Â  Â  Â  Â  .error-message { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 15px; margin: 20px 0; border-radius: 8px; text-align: center; }
Â  Â  Â  Â  body.dark-theme .error-message { background-color: #4a2c2c; border-color: #dc3545; color: #f8d7da; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* --- Practice Page Styles --- */
Â  Â  Â  Â  .practice-container { background-color: var(--card-bg-color); padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px var(--shadow-color); }
Â  Â  Â  Â  .practice-exercise { margin-bottom: 40px; border-bottom: 1px solid var(--border-color); padding-bottom: 20px; }
Â  Â  Â  Â  .practice-exercise:last-child { border-bottom: none; margin-bottom: 0; }
Â  Â  Â  Â  .practice-exercise h2 { color: var(--header-text-color); padding-bottom: 10px; margin-bottom: 20px; font-size: 1.4em; }
Â  Â  Â  Â  .word-bank { display: flex; flex-direction: row; flex-wrap: wrap; gap: 10px; padding: 15px; background-color: var(--bg-color); border-radius: 8px; min-height: 50px; justify-content: center; }
Â  Â  Â  Â  .word-drag { padding: 8px 16px; background-color: var(--card-bg-color); color: var(--text-color); border: 1px solid var(--border-color); border-radius: 20px; cursor: grab; user-select: none; transition: all 0.2s ease; text-align: center; }
Â  Â  Â  Â  .word-drag:hover { background-color: var(--primary-accent); color: white; border-color: var(--primary-accent); transform: scale(1.05); }
Â  Â  Â  Â  .drop-zone { padding: 20px; background-color: var(--bg-color); border: 2px dashed var(--border-color); border-radius: 8px; min-height: 60px; transition: background-color 0.3s ease; display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
Â  Â  Â  Â  .drop-zone.over { background-color: #d0eaff; }
Â  Â  Â  Â  body.dark-theme .drop-zone.over { background-color: #003c7a; }
Â  Â  Â  Â  .check-btn { width: 100%; padding: 12px; font-size: 16px; background: var(--secondary-accent); color: white; border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.3s; margin-top: 15px; }
Â  Â  Â  Â  .check-btn:hover { background-color: #218838; }
Â  Â  Â  Â  .feedback-message { margin-top: 15px; padding: 10px; border-radius: 5px; text-align: center; font-weight: bold; display: none; }
Â  Â  Â  Â  .feedback-message.correct { background-color: var(--success-accent); color: white; }
Â  Â  Â  Â  .feedback-message.incorrect { background-color: var(--danger-accent); color: white; }
Â  Â  Â  Â  #no-practice-message { text-align: center; color: var(--subtle-text-color); font-style: italic; padding: 40px 0; }
Â  Â  Â  Â  .article-quiz-question { text-align: center; margin-bottom: 15px; font-size: 1.2em; }
Â  Â  Â  Â  .article-quiz-question .noun { font-weight: bold; color: var(--primary-accent); }
Â  Â  Â  Â  .article-quiz-options { display: flex; justify-content: center; gap: 15px; }
Â  Â  Â  Â  .article-quiz-btn { padding: 10px 25px; font-size: 1.1em; border-radius: 8px; border: 1px solid var(--border-color); background-color: var(--card-bg-color); cursor: pointer; transition: all 0.2s ease; }
Â  Â  Â  Â  .article-quiz-btn:hover { background-color: var(--primary-accent); color: white; transform: scale(1.05); }
Â  Â  Â  Â  .translation-input, .listening-input { width: 100%; min-height: 60px; padding: 15px; border: 1px solid var(--border-color); background-color: var(--bg-color); color: var(--text-color); border-radius: 8px; font-size: 16px; font-family: 'Georgia', serif; margin-top: 15px; resize: vertical; }
Â  Â  Â  Â  .lueckentext-input { padding: 4px 8px; font-size: 1em; border: 1px solid var(--border-color); border-radius: 4px; background-color: var(--bg-color); color: var(--text-color); width: 120px; }

Â  Â  Â  Â  /* Memory Game Styles */
Â  Â  Â  Â  .memory-game-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; perspective: 1000px; }
Â  Â  Â  Â  .memory-card { background-color: transparent; width: 100%; aspect-ratio: 3/2; border-radius: 8px; cursor: pointer; position: relative; transform-style: preserve-3d; transition: transform 0.5s; }
Â  Â  Â  Â  .memory-card.flip { transform: rotateY(180deg); }
Â  Â  Â  Â  .memory-card .front-face, .memory-card .back-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; justify-content: center; align-items: center; text-align: center; padding: 10px; border-radius: 8px; }
Â  Â  Â  Â  .memory-card .front-face { background-color: var(--primary-accent); color: white; }
Â  Â  Â  Â  .memory-card .back-face { background-color: var(--card-bg-color); border: 1px solid var(--border-color); color: var(--text-color); transform: rotateY(180deg); }
Â  Â  Â  Â  .memory-game-controls { text-align: center; margin-top: 15px; font-size: 1.2em; }

Â  Â  Â  Â  /* Crossword Styles */
Â  Â  Â  Â  .crossword-container { display: flex; flex-wrap: wrap; gap: 30px; justify-content: center; }
Â  Â  Â  Â  .crossword-grid { border-collapse: collapse; }
Â  Â  Â  Â  .crossword-grid td { width: 30px; height: 30px; text-align: center; vertical-align: middle; border: 1px solid var(--border-color); background-color: var(--card-bg-color); color: var(--text-color); font-size: 16px; position: relative; }
Â  Â  Â  Â  .crossword-grid td.empty { background-color: transparent; border: none; }
Â  Â  Â  Â  .crossword-grid td .word-start-number { position: absolute; top: 1px; left: 2px; font-size: 10px; color: var(--subtle-text-color); }
Â  Â  Â  Â  .crossword-grid input { width: 100%; height: 100%; text-align: center; border: none; background-color: transparent; font-size: 16px; color: var(--text-color); padding: 0; text-transform: uppercase; }
Â  Â  Â  Â  .crossword-grid input:focus { outline: 2px solid var(--primary-accent); }
Â  Â  Â  Â  .crossword-grid input.correct { background-color: #d4edda; }
Â  Â  Â  Â  body.dark-theme .crossword-grid input.correct { background-color: #2a352c; }
Â  Â  Â  Â  .crossword-grid input.incorrect { background-color: #f8d7da; }
Â  Â  Â  Â  body.dark-theme .crossword-grid input.incorrect { background-color: #4a2c2c; }
Â  Â  Â  Â  .crossword-clues { flex-grow: 1; min-width: 250px; }
Â  Â  Â  Â  .crossword-clues h3 { margin-top: 0; color: var(--header-text-color); }
Â  Â  Â  Â  .crossword-clues ol { padding-left: 25px; }
Â  Â  Â  Â  .crossword-clues li { margin-bottom: 8px; }
Â  Â  Â  Â  .crossword-controls { display: flex; gap: 10px; margin-top: 15px; justify-content: center; }

Â  Â  Â  Â  /* --- Settings Modal Styles --- */
Â  Â  Â  Â  .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--modal-overlay-color); display: flex; justify-content: center; align-items: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }
Â  Â  Â  Â  .modal-overlay.visible { opacity: 1; visibility: visible; }
Â  Â  Â  Â  .modal-content { background: var(--card-bg-color); padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); width: 90%; max-width: 500px; position: relative; transform: scale(0.9); transition: transform 0.3s ease; }
Â  Â  Â  Â  .modal-overlay.visible .modal-content { transform: scale(1); }
Â  Â  Â  Â  .modal-close-btn { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 24px; cursor: pointer; color: var(--subtle-text-color); }
Â  Â  Â  Â  .modal-content h2 { margin-top: 0; color: var(--header-text-color); border-bottom: 1px solid var(--border-color); padding-bottom: 10px; margin-bottom: 20px; }
Â  Â  Â  Â  .settings-section { margin-bottom: 25px; }
Â  Â  Â  Â  .settings-section h3 { margin-bottom: 15px; color: var(--header-text-color); }
Â  Â  Â  Â  .control-group { margin-bottom: 15px; }
Â  Â  Â  Â  .control-group label { display: block; margin-bottom: 8px; font-weight: bold; color: var(--text-color); }
Â  Â  Â  Â  .control-row { display: flex; align-items: center; gap: 15px; flex-wrap: wrap; }
Â  Â  Â  Â  .control-row select, .control-row input { width: 100%; max-width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 14px; background-color: var(--bg-color); color: var(--text-color); }
Â  Â  Â  Â  .control-row input[type="range"] { width: auto; flex-grow: 1; }
Â  Â  Â  Â  .range-value { font-weight: bold; color: var(--primary-accent); min-width: 30px; }
Â  Â  Â  Â  .theme-switch-wrapper { display: flex; align-items: center; gap: 10px; }
Â  Â  Â  Â  .theme-switch { position: relative; display: inline-block; width: 50px; height: 28px; }
Â  Â  Â  Â  .theme-switch input { opacity: 0; width: 0; height: 0; }
Â  Â  Â  Â  .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
Â  Â  Â  Â  .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
Â  Â  Â  Â  input:checked + .slider { background-color: var(--primary-accent); }
Â  Â  Â  Â  input:checked + .slider:before { transform: translateX(22px); }
        
        /* --- NEW STYLES ADDED HERE --- */
        /* Podcast Player Styles */
        .podcast-player { background: var(--card-bg-color); border-radius: 16px; padding: 25px; box-shadow: 0 4px 12px var(--shadow-color); }
        .podcast-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .podcast-controls-top { display: flex; gap: 10px; }
        #podcast-category { padding: 8px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--bg-color); color: var(--text-color); }
        .episode-player { background: var(--bg-color); padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        .player-controls { display: flex; align-items: center; gap: 15px; margin: 15px 0; }
        .progress-bar { flex: 1; height: 8px; background: var(--border-color); border-radius: 4px; cursor: pointer; }
        .progress-fill { height: 100%; background: var(--primary-accent); border-radius: 4px; width: 0%; transition: width 0.1s; }
        /* AI Chat Styles */
        .ai-conversation-container { background: var(--card-bg-color); border-radius: 16px; padding: 25px; box-shadow: 0 4px 12px var(--shadow-color); }
        .chat-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid var(--border-color); }
        .ai-status { display: flex; align-items: center; gap: 10px; }
        .status-indicator { width: 12px; height: 12px; border-radius: 50%; background: #10b981; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .chat-window { height: 400px; overflow-y: auto; padding: 20px; background: var(--bg-color); border-radius: 12px; margin-bottom: 20px; }
        .message { display: flex; gap: 12px; margin-bottom: 20px; animation: fadeIn 0.3s ease; }
        .message-avatar { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; background: var(--primary-accent); }
        .message-content { flex: 1; }
        .message-text { background: var(--card-bg-color); padding: 12px 16px; border-radius: 12px; }
        .grammar-correction { background: #fef3c7; border-left: 4px solid #f59e0b; padding: 8px 12px; margin-top: 8px; border-radius: 4px; font-size: 0.9em; }
        body.dark-theme .grammar-correction { background: #3e3829; border-left-color: #f59e0b; }
        .chat-input-container { display: flex; gap: 10px; }
        .chat-input { flex: 1; padding: 12px 16px; border: 2px solid var(--border-color); border-radius: 25px; font-size: 16px; background: var(--bg-color); color: var(--text-color); }
        .send-btn { background: var(--primary-accent); color: white; border: none; border-radius: 25px; padding: 12px 24px; cursor: pointer; font-weight: bold; }
        .performance-panel, .suggestions-panel { background: var(--bg-color); padding: 20px; border-radius: 12px; margin-top: 20px; }
        .metrics-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-top: 15px; }
        .metric { text-align: center; padding: 15px; background: var(--card-bg-color); border-radius: 8px; }
        .metric-label { display: block; font-size: 0.9em; color: var(--text-secondary); margin-bottom: 5px; }
        .metric-value { display: block; font-size: 1.5em; font-weight: bold; color: var(--primary-accent); }

Â  Â  Â  Â  @media (max-width: 768px) {
Â  Â  Â  Â  Â  Â  .header-top { flex-direction: column; text-align: center; }
Â  Â  Â  Â  Â  Â  header h1 { text-align: center; font-size: 1.8em; margin-bottom: 15px; }
Â  Â  Â  Â  Â  Â  .nav-buttons { flex-direction: column; align-items: center; }
Â  Â  Â  Â  Â  Â  .nav-btn { width: 100%; max-width: 280px; }
Â  Â  Â  Â  Â  Â  #article-display-container, .practice-container { padding: 15px; }
Â  Â  Â  Â  Â  Â  .german-text { font-size: 16px; }
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  <div class="container">
Â  Â  Â  Â  <header>
Â  Â  Â  Â  Â  Â  <div class="header-top">
Â  Â  Â  Â  Â  Â  Â  Â  <h1>Daily German Learning</h1>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="header-controls">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="settings-btn" title="Settings">âš™ï¸</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <p>Master German with themed articles and real-world scenarios</p>
Â  Â  Â  Â  </header>
Â  Â  Â  Â  <nav id="main-nav">
Â  Â  Â  Â  Â  Â  <button class="nav-tab active" data-page="articles-page">ğŸ“– Articles</button>
Â  Â  Â  Â  Â  Â  <button class="nav-tab" data-page="podcast-page">ğŸ§ Podcasts</button>
Â  Â  Â  Â  Â  Â  <button class="nav-tab" data-page="conversation-page">ğŸ’¬ AI Teacher</button>
Â  Â  Â  Â  Â  Â  <button class="nav-tab" data-page="grammar-drill-page">âœï¸ Grammar Drill</button>
Â  Â  Â  Â  Â  Â  <button class="nav-tab" data-page="performance-page">ğŸ“Š My Progress</button>
Â  Â  Â  Â  </nav>
Â  Â  Â  Â  <main id="main-content">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="articles-page" class="page active">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="level-navigation"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="search-container" id="search-container" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="search-input" class="search-input" placeholder="Search articles, themes, or vocabulary...">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="loading">Loading articles...</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="article-display-container" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="sub-nav">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button class="sub-nav-tab active" data-target="article-content">Article</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button class="sub-nav-tab" data-target="deep-dive-content">Deep Dive Grammar</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <button class="sub-nav-tab" data-target="practice-content">Practice</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="article-content" class="sub-page active practice-container"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="deep-dive-content" class="sub-page practice-container"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="practice-content" class="sub-page practice-container"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="nav-buttons" id="nav-buttons" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="nav-btn" onclick="navigateArticle('previous')">â† Previous Article</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="nav-btn" onclick="resetSearch()">ğŸ”„ Show All / Latest</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="nav-btn" onclick="navigateArticle('next')">Next Article â†’</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="article-info" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><small>Article <span id="current-article-number">1</span> of <span id="total-articles">0</span> | <span id="current-date"></span></small></p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  
            <div id="podcast-page" class="page">
                <div class="podcast-player">
                    <div class="podcast-header">
                        <h2>ğŸ§ German Learning Podcasts</h2>
                        <div class="podcast-controls-top">
                            <select id="podcast-category">
                                <option value="ai-tech">AI & Technology</option>
                                <option value="finance-business">Finance & Business</option>
                                <option value="leadership-strategy">Leadership & Strategy</option>
                                <option value="science-innovation">Science & Innovation</option>
                                <option value="sunday-specials">Lifestyle & Culture</option>
                            </select>
                            <button id="load-podcast-btn" class="nav-btn">Load Episodes</button>
                        </div>
                    </div>
            
                    <div id="podcast-loading" style="display: none; text-align: center; padding: 20px;">
                        <p>Loading podcasts... â³</p>
                    </div>
            
                    <div id="podcast-error" style="display: none; padding: 20px; background: #fee; border-radius: 10px; margin: 20px 0;">
                        <p style="color: #c00;">Error loading podcasts. Please try again.</p>
                    </div>
            
                    <div id="current-episode" style="display: none;">
                        <div class="episode-player">
                            <h3 id="episode-title">Episode Title</h3>
                            <div class="player-controls">
                                <button id="play-pause-btn" class="audio-btn">â–¶ï¸</button>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="progress-fill"></div>
                                </div>
                                <span id="time-display">0:00 / 0:00</span>
                            </div>
                            <div class="playback-speed">
                                <label>Speed:</label>
                                <select id="playback-speed">
                                    <option value="0.75">0.75x</option>
                                    <option value="1" selected>1x</option>
                                    <option value="1.25">1.25x</option>
                                    <option value="1.5">1.5x</option>
                                </select>
                            </div>
                        </div>
            
                        <div class="transcript-section">
                            <h3>ğŸ“ Transcript (Color-Coded Grammar)</h3>
                            <div id="podcast-transcript" class="german-text">
                                </div>
                        </div>
            
                        <div class="vocabulary-section">
                            <h3>ğŸ“š Key Vocabulary</h3>
                            <div id="episode-vocabulary">
                                </div>
                        </div>
                    </div>
            
                    <div id="episode-list">
                        <h3>Available Episodes</h3>
                        <div id="episodes-container">
                            </div>
                    </div>
                </div>
            </div>

            <div id="conversation-page" class="page">
                <div class="ai-conversation-container">
                    <div class="chat-header">
                        <h2>ğŸ’¬ AI German Teacher</h2>
                        <div class="ai-status">
                            <span class="status-indicator" id="ai-status"></span>
                            <span id="ai-status-text">Ready to chat</span>
                        </div>
                    </div>
            
                    <div class="chat-window" id="chat-window">
                        <div class="message ai-message">
                            <div class="message-avatar">ğŸ¤–</div>
                            <div class="message-content">
                                <div class="message-text">
                                    Guten Tag! Ich bin dein KI-Deutschlehrer. Lass uns Ã¼ber den Podcast sprechen, den du gerade gehÃ¶rt hast, oder stelle mir Fragen zur deutschen Sprache!
                                </div>
                            </div>
                        </div>
                    </div>
            
                    <div class="chat-input-container">
                        <input type="text" id="chat-input" class="chat-input" placeholder="Schreib auf Deutsch... (Type in German)">
                        <button id="send-btn" class="send-btn">Send</button>
                    </div>
            
                    <div class="performance-panel">
                        <h3>Your Performance</h3>
                        <div class="metrics-grid">
                            <div class="metric">
                                <span class="metric-label">Accuracy</span>
                                <span class="metric-value" id="accuracy-score">--</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Fluency</span>
                                <span class="metric-value" id="fluency-score">--</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Grammar</span>
                                <span class="metric-value" id="grammar-score">--</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Vocabulary</span>
                                <span class="metric-value" id="vocab-score">--</span>
                            </div>
                        </div>
                    </div>
            
                    <div class="suggestions-panel" id="suggestions-panel" style="display: none;">
                        <h3>Suggestions for Improvement</h3>
                        <ul id="suggestions-list">
                            </ul>
                    </div>
                </div>
            </div>

            <div id="performance-page" class="page">
            Â  Â  <div style="padding: 20px; background: #f0f0f0; border-radius: 10px;">
            Â  Â  Â  Â  <h2>ğŸ“Š Your Progress</h2>
            Â  Â  Â  Â  <p>ğŸš§ Coming Soon! Track your German learning progress.</p>
            Â  Â  </div>
            </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="grammar-drill-page" class="page">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="practice-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2>Grammar Drill</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Select one or more grammar topics to practice them with new, unseen sentences.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="grammar-topic-tags" class="word-bank"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="start-drill-btn" class="check-btn">Start Drill</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="drill-container"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </main>
Â  Â  </div>

Â  Â  Â  Â  <div id="settings-modal" class="modal-overlay">
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  <button class="modal-close-btn">&times;</button>
Â  Â  Â  Â  Â  Â  <h2>Site Settings</h2>
Â  Â  Â  Â  Â  Â  <div class="settings-section">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>Appearance</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="control-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>Theme</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="theme-switch-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>ğŸŒ Light</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="theme-switch" for="theme-checkbox"><input type="checkbox" id="theme-checkbox" /><div class="slider"></div></label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>ğŸŒ™ Dark</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="settings-section">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>Audio (Text-to-Speech)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="control-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="voice-select">Voice</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="control-row"><select id="voice-select"><option>Loading...</option></select></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="control-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="rate-control">Speech Rate</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="control-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="range" id="rate-control" min="0.5" max="1.5" step="0.1"><span class="range-value" id="rate-value">1.0</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="control-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="pitch-control">Pitch</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="control-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="range" id="pitch-control" min="0.5" max="2" step="0.1"><span class="range-value" id="pitch-value">1.0</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â Â 
Â  Â  <script>
Â  Â  Â  Â  // --- App Configuration & Global State ---
Â  Â  Â  Â  let articles = [];
Â  Â  Â  Â  let filteredArticles = [];
Â  Â  Â  Â  let currentArticle = null;
Â  Â  Â  Â  const synth = window.speechSynthesis;
Â  Â  Â  Â  let voices = [];

Â  Â  Â  Â  // --- Security: HTML Sanitization ---
Â  Â  Â  Â  function sanitizeHTML(input) {
Â  Â  Â  Â  Â  Â  if (typeof input !== 'string') return '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Create a temporary div to parse HTML
Â  Â  Â  Â  Â  Â  const temp = document.createElement('div');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Set as text first to escape any dangerous content
Â  Â  Â  Â  Â  Â  temp.textContent = input;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // For cases where we need basic HTML formatting, allow only safe tags
Â  Â  Â  Â  Â  Â  const allowedTags = ['b', 'strong', 'i', 'em', 'br', 'p', 'span', 'div'];
Â  Â  Â  Â  Â  Â  const allowedClasses = ['noun-m', 'noun-f', 'noun-n', 'verb', 'adjective', 'adverb',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 'preposition', 'conjunction', 'pronoun', 'article', 'punctuation'];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  return input
Â  Â  Â  Â  Â  Â  Â  Â  .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '') // Remove script tags
Â  Â  Â  Â  Â  Â  Â  Â  .replace(/javascript:/gi, '') // Remove javascript: protocols
Â  Â  Â  Â  Â  Â  Â  Â  .replace(/on\w+\s*=/gi, '') // Remove event handlers
Â  Â  Â  Â  Â  Â  Â  Â  .replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi, '') // Remove iframes
Â  Â  Â  Â  Â  Â  Â  Â  .replace(/<object\b[^<]*(?:(?!<\/object>)<[^<]*)*<\/object>/gi, '') // Remove objects
Â  Â  Â  Â  Â  Â  Â  Â  .replace(/<embed\b[^<]*(?:(?!<\/embed>)<[^<]*)*<\/embed>/gi, ''); // Remove embeds
Â  Â  Â  Â  }

Â  Â  Â  Â  function safeSetHTML(element, content) {
Â  Â  Â  Â  Â  Â  if (!element) return;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // If content contains no HTML tags, use textContent for safety
Â  Â  Â  Â  Â  Â  if (!/[<>]/.test(content)) {
Â  Â  Â  Â  Â  Â  Â  Â  element.textContent = content;
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Otherwise, sanitize and set innerHTML
Â  Â  Â  Â  Â  Â  element.innerHTML = sanitizeHTML(content);
Â  Â  Â  Â  }

Â  Â  Â  Â  function safeAppendHTML(element, content) {
Â  Â  Â  Â  Â  Â  if (!element) return;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const sanitized = sanitizeHTML(content);
Â  Â  Â  Â  Â  Â  const temp = document.createElement('div');
Â  Â  Â  Â  Â  Â  temp.innerHTML = sanitized;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Append each child node safely
Â  Â  Â  Â  Â  Â  while (temp.firstChild) {
Â  Â  Â  Â  Â  Â  Â  Â  element.appendChild(temp.firstChild);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- DOM Elements ---
Â  Â  Â  Â  const settingsBtn = document.getElementById('settings-btn');
Â  Â  Â  Â  const settingsModal = document.getElementById('settings-modal');
Â  Â  Â  Â  const themeToggle = document.getElementById('theme-checkbox');
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- Initialization ---
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', function() {
Â  Â  Â  Â  Â  Â  loadSettings();
Â  Â  Â  Â  Â  Â  setupEventListeners();
Â  Â  Â  Â  Â  Â  loadArticles();Â 
Â  Â  Â  Â  });

Â  Â  Â  Â  // --- Settings Management ---
Â  Â  Â  Â  function loadSettings() {
Â  Â  Â  Â  Â  Â  const settings = getSettings();
Â  Â  Â  Â  Â  Â  document.body.classList.toggle('dark-theme', settings.theme === 'dark');
Â  Â  Â  Â  Â  Â  themeToggle.checked = settings.theme === 'dark';
Â  Â  Â  Â  Â  Â  document.getElementById('rate-control').value = settings.rate;
Â  Â  Â  Â  Â  Â  document.getElementById('rate-value').textContent = settings.rate;
Â  Â  Â  Â  Â  Â  document.getElementById('pitch-control').value = settings.pitch;
Â  Â  Â  Â  Â  Â  document.getElementById('pitch-value').textContent = settings.pitch;
Â  Â  Â  Â  }

Â  Â  Â  Â  function getSettings() {
Â  Â  Â  Â  Â  Â  const defaults = { theme: 'light', voiceURI: null, rate: 0.9, pitch: 1.0 };
Â  Â  Â  Â  Â  Â  const storedSettings = JSON.parse(localStorage.getItem('germanAppSettings')) || {};
Â  Â  Â  Â  Â  Â  return { ...defaults, ...storedSettings };
Â  Â  Â  Â  }

Â  Â  Â  Â  function saveSettings(newSettings) {
Â  Â  Â  Â  Â  Â  const currentSettings = getSettings();
Â  Â  Â  Â  Â  Â  localStorage.setItem('germanAppSettings', JSON.stringify({ ...currentSettings, ...newSettings }));
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Event Listeners Setup ---
Â  Â  Â  Â  function setupEventListeners() {
Â  Â  Â  Â  Â  Â  settingsBtn.addEventListener('click', () => settingsModal.classList.add('visible'));
Â  Â  Â  Â  Â  Â  settingsModal.querySelector('.modal-close-btn').addEventListener('click', () => settingsModal.classList.remove('visible'));
Â  Â  Â  Â  Â  Â  settingsModal.addEventListener('click', (e) => { if (e.target === settingsModal) settingsModal.classList.remove('visible'); });
Â  Â  Â  Â  Â  Â  themeToggle.addEventListener('change', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  const theme = e.target.checked ? 'dark' : 'light';
Â  Â  Â  Â  Â  Â  Â  Â  document.body.classList.toggle('dark-theme', e.target.checked);
Â  Â  Â  Â  Â  Â  Â  Â  saveSettings({ theme });
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  document.getElementById('voice-select').addEventListener('change', e => saveSettings({ voiceURI: e.target.value }));
Â  Â  Â  Â  Â  Â  document.getElementById('rate-control').addEventListener('input', e => {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('rate-value').textContent = e.target.value;
Â  Â  Â  Â  Â  Â  Â  Â  saveSettings({ rate: parseFloat(e.target.value) });
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  document.getElementById('pitch-control').addEventListener('input', e => {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('pitch-value').textContent = e.target.value;
Â  Â  Â  Â  Â  Â  Â  Â  saveSettings({ pitch: parseFloat(e.target.value) });
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.nav-tab').forEach(tab => {
Â  Â  Â  Â  Â  Â  Â  Â  tab.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.target.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const targetPageId = e.target.getAttribute('data-page');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.page').forEach(page => page.classList.toggle('active', page.id === targetPageId));
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  const searchInput = document.getElementById('search-input');
Â  Â  Â  Â  Â  Â  searchInput.addEventListener('keypress', e => (e.key === 'Enter') && searchArticles(e.target.value));
Â  Â  Â  Â  Â  Â  document.addEventListener('keydown', function(event) {
Â  Â  Â  Â  Â  Â  Â  Â  const activePage = document.querySelector('.page.active');
Â  Â  Â  Â  Â  Â  Â  Â  if (document.activeElement !== searchInput && activePage && activePage.id === 'articles-page') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (event.key === 'ArrowLeft') navigateArticle('previous');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (event.key === 'ArrowRight') navigateArticle('next');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (event.key === 'Home') { event.preventDefault(); resetSearch(); }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  document.getElementById('start-drill-btn').addEventListener('click', startGrammarDrill);
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Secure Configuration Management ---
Â  Â  Â  Â  async function getSecureConfig() {
Â  Â  Â  Â  Â  Â  // OPTION 1: Netlify Functions (SECURE - API key stays on server)
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  console.log('ğŸ”’ Using secure Netlify function');
Â  Â  Â  Â  Â  Â  Â  Â  return { useNetlifyFunction: true };
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  console.warn('Netlify function not available');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // OPTION 2: URL Parameters (for development/testing only - NOT secure)
Â  Â  Â  Â  Â  Â  const urlParams = new URLSearchParams(window.location.search);
Â  Â  Â  Â  Â  Â  if (urlParams.get('dev') === 'true') {
Â  Â  Â  Â  Â  Â  Â  Â  console.warn('âš ï¸ DEVELOPMENT MODE: Using URL parameters - NOT secure for production!');
Â  Â  Â  Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sheetId: urlParams.get('sheetId') || '',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  apiKey: urlParams.get('apiKey') || '',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sheetName: 'Sheet1'
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // FALLBACK: Return empty config to trigger sample data
Â  Â  Â  Â  Â  Â  console.warn('âš ï¸ No secure configuration found. Using sample data.');
Â  Â  Â  Â  Â  Â  return { sheetId: '', apiKey: '', sheetName: 'Sheet1' };
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Data Loading ---
Â  Â  Â  Â  async function loadArticles() {
Â  Â  Â  Â  Â  Â  document.getElementById('loading').style.display = 'block';
Â  Â  Â  Â  Â  Â  document.getElementById('article-display-container').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('practice-content').innerHTML = '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // SECURITY FIX: Get configuration from secure source
Â  Â  Â  Â  Â  Â  const config = await getSecureConfig();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  let data;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (config.useNetlifyFunction) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Use secure Netlify function
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ğŸ“¡ Fetching data via secure function...');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch('/.netlify/functions/get-articles');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(`Function request failed with status ${response.status}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  } else if (config.sheetId && config.apiKey) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Use direct API call (for dev mode)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log('ğŸ“¡ Fetching data via direct API...');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const url = `https://sheets.googleapis.com/v4/spreadsheets/${config.sheetId}/values/${config.sheetName || 'Sheet1'}?key=${config.apiKey}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(url);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const errorData = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const errorMessage = errorData.error?.message || `API request failed with status ${response.status}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(`Failed to load from Google Sheets: ${errorMessage}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('No configuration available');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (!data.values || data.values.length < 2) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('No data found in the sheet or sheet is empty.');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  articles = parseSheetData(data.values);
Â  Â  Â  Â  Â  Â  Â  Â  initializeContent();

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error loading articles:', error);
Â  Â  Â  Â  Â  Â  Â  Â  showError(`${error.message}. Using sample data for demonstration.`);
Â  Â  Â  Â  Â  Â  Â  Â  articles = getSampleData();
Â  Â  Â  Â  Â  Â  Â  Â  initializeContent();
Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('loading').style.display = 'none';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function initializeContent() {
Â  Â  Â  Â  Â  Â  if (articles.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  filteredArticles = [...articles];
Â  Â  Â  Â  Â  Â  Â  Â  setupLevelNavigation();
Â  Â  Â  Â  Â  Â  Â  Â  displayLatestArticle();
Â  Â  Â  Â  Â  Â  Â  Â  setupGrammarDrill();
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('search-container').style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('nav-buttons').style.display = 'flex';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('article-info').style.display = 'block';
Â  Â  Â  Â  Â  Â  } else {Â 
Â  Â  Â  Â  Â  Â  Â  Â  showError('No "Published" articles found.');Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function parseSheetData(rows) {
Â  Â  Â  Â  Â  Â  const headers = rows[0].map(h => h.trim().toUpperCase().replace(/\s+/g, '_').replace('&', 'AND'));
Â  Â  Â  Â  Â  Â  const data = [];
Â  Â  Â  Â  Â  Â  const statusIndex = headers.indexOf('STATUS');

Â  Â  Â  Â  Â  Â  for (let i = 1; i < rows.length; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  const row = rows[i];
Â  Â  Â  Â  Â  Â  Â  Â  if (statusIndex !== -1 && row[statusIndex] && row[statusIndex].trim() === 'Published') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let article = {};
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers.forEach((header, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  article[header] = row[index] || '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data.push(article);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return data.sort((a, b) => new Date(b.DATE) - new Date(a.DATE));
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Article Display & Navigation ---
Â  Â  Â  Â  function displayLatestArticle() { if (articles.length > 0) displayArticle(articles[0]); }
Â  Â  Â  Â  function displayArticle(article) {
Â  Â  Â  Â  Â  Â  currentArticle = article;
Â  Â  Â  Â  Â  Â  synth.cancel();
Â  Â  Â  Â  Â  Â  const displayContainer = document.getElementById('article-display-container');
Â  Â  Â  Â  Â  Â  const safeGet = (field, fallback = '') => article[field.toUpperCase().replace(/\s+/g, '_').replace('&', 'AND')] || fallback;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const articleContent = document.getElementById('article-content');
Â  Â  Â  Â  Â  Â  articleContent.innerHTML = ''; // Clear existing content safely
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Create audio player container
Â  Â  Â  Â  Â  Â  const audioContainer = document.createElement('div');
Â  Â  Â  Â  Â  Â  audioContainer.id = 'audio-player-container';
Â  Â  Â  Â  Â  Â  const playBtn = document.createElement('button');
Â  Â  Â  Â  Â  Â  playBtn.id = 'play-pause-btn';
Â  Â  Â  Â  Â  Â  playBtn.className = 'audio-btn';
Â  Â  Â  Â  Â  Â  playBtn.title = 'Play/Pause';
Â  Â  Â  Â  Â  Â  playBtn.textContent = 'â–¶ï¸';
Â  Â  Â  Â  Â  Â  const audioStatus = document.createElement('span');
Â  Â  Â  Â  Â  Â  audioStatus.id = 'audio-status';
Â  Â  Â  Â  Â  Â  audioStatus.textContent = 'Read Aloud';
Â  Â  Â  Â  Â  Â  audioContainer.appendChild(playBtn);
Â  Â  Â  Â  Â  Â  audioContainer.appendChild(audioStatus);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Create metadata section
Â  Â  Â  Â  Â  Â  const metadata = document.createElement('div');
Â  Â  Â  Â  Â  Â  metadata.className = 'metadata';
Â  Â  Â  Â  Â  Â  metadata.innerHTML = `<strong>Level:</strong> ${sanitizeHTML(safeGet('LEVEL'))} | <strong>Theme:</strong> ${sanitizeHTML(safeGet('THEME'))}`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Create German text section (this needs to preserve grammar highlighting)
Â  Â  Â  Â  Â  Â  const germanText = document.createElement('div');
Â  Â  Â  Â  Â  Â  germanText.className = 'german-text';
Â  Â  Â  Â  Â  Â  safeSetHTML(germanText, safeGet('GERMAN_ARTICLE'));
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Create English text section
Â  Â  Â  Â  Â  Â  const englishText = document.createElement('div');
Â  Â  Â  Â  Â  Â  englishText.className = 'english-text';
Â  Â  Â  Â  Â  Â  englishText.textContent = safeGet('ENGLISH_TRANSLATION');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Create vocabulary section
Â  Â  Â  Â  Â  Â  const vocabSection = document.createElement('div');
Â  Â  Â  Â  Â  Â  vocabSection.className = 'article-section vocabulary-section';
Â  Â  Â  Â  Â  Â  vocabSection.innerHTML = '<strong>ğŸ¯ Key Vocabulary:</strong>';
Â  Â  Â  Â  Â  Â  const vocabContent = document.createElement('div');
Â  Â  Â  Â  Â  Â  vocabContent.textContent = safeGet('VOCABULARY_USED');
Â  Â  Â  Â  Â  Â  vocabSection.appendChild(vocabContent);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Create phrases section
Â  Â  Â  Â  Â  Â  const phrasesSection = document.createElement('div');
Â  Â  Â  Â  Â  Â  phrasesSection.className = 'article-section phrases-section';
Â  Â  Â  Â  Â  Â  phrasesSection.innerHTML = '<strong>ğŸ’¬ Phrase & Idiom:</strong>';
Â  Â  Â  Â  Â  Â  const phrasesContent = document.createElement('div');
Â  Â  Â  Â  Â  Â  safeSetHTML(phrasesContent, safeGet('PHRASE_AND_IDIOM'));
Â  Â  Â  Â  Â  Â  phrasesSection.appendChild(phrasesContent);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Create quotes section
Â  Â  Â  Â  Â  Â  const quotesSection = document.createElement('div');
Â  Â  Â  Â  Â  Â  quotesSection.className = 'article-section quotes-section';
Â  Â  Â  Â  Â  Â  quotesSection.innerHTML = '<strong>ğŸ˜„ Quote & Joke:</strong>';
Â  Â  Â  Â  Â  Â  const quotesContent = document.createElement('div');
Â  Â  Â  Â  Â  Â  safeSetHTML(quotesContent, safeGet('QUOTE_AND_JOKE'));
Â  Â  Â  Â  Â  Â  quotesSection.appendChild(quotesContent);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Create conversation section
Â  Â  Â  Â  Â  Â  const conversationSection = document.createElement('div');
Â  Â  Â  Â  Â  Â  conversationSection.className = 'article-section conversation-section';
Â  Â  Â  Â  Â  Â  conversationSection.innerHTML = '<strong>ğŸ—£ï¸ Conversation Time:</strong>';
Â  Â  Â  Â  Â  Â  const conversationContent = document.createElement('div');
Â  Â  Â  Â  Â  Â  safeSetHTML(conversationContent, safeGet('CONVERSATION_TIME'));
Â  Â  Â  Â  Â  Â  conversationSection.appendChild(conversationContent);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Append all sections safely
Â  Â  Â  Â  Â  Â  articleContent.appendChild(audioContainer);
Â  Â  Â  Â  Â  Â  articleContent.appendChild(metadata);
Â  Â  Â  Â  Â  Â  articleContent.appendChild(germanText);
Â  Â  Â  Â  Â  Â  articleContent.appendChild(englishText);
Â  Â  Â  Â  Â  Â  articleContent.appendChild(vocabSection);
Â  Â  Â  Â  Â  Â  articleContent.appendChild(phrasesSection);
Â  Â  Â  Â  Â  Â  articleContent.appendChild(quotesSection);
Â  Â  Â  Â  Â  Â  articleContent.appendChild(conversationSection);

Â  Â  Â  Â  Â  Â  const deepDiveContent = document.getElementById('deep-dive-content');
Â  Â  Â  Â  Â  Â  deepDiveContent.innerHTML = ''; // Clear existing content safely
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const grammarSection = document.createElement('div');
Â  Â  Â  Â  Â  Â  grammarSection.className = 'article-section grammar-section';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const grammarTitle = document.createElement('strong');
Â  Â  Â  Â  Â  Â  grammarTitle.textContent = 'ğŸ§  Deep Dive Grammar:';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const grammarContent = document.createElement('div');
Â  Â  Â  Â  Â  Â  safeSetHTML(grammarContent, safeGet('DEEP_DIVE_GRAMMAR'));
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  grammarSection.appendChild(grammarTitle);
Â  Â  Â  Â  Â  Â  grammarSection.appendChild(grammarContent);
Â  Â  Â  Â  Â  Â  deepDiveContent.appendChild(grammarSection);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  displayContainer.style.display = 'block';
Â  Â  Â  Â  Â  Â  setupAudioPlayer();
Â  Â  Â  Â  Â  Â  updateArticleCounter();
Â  Â  Â  Â  Â  Â  setupPracticeExercises(article);
Â  Â  Â  Â  Â  Â  setupSubNav();
Â  Â  Â  Â  }
Â  Â  Â  Â  function navigateArticle(direction) {
Â  Â  Â  Â  Â  Â  const currentIndex = filteredArticles.indexOf(currentArticle);
Â  Â  Â  Â  Â  Â  if (currentIndex === -1) return;
Â  Â  Â  Â  Â  Â  let newIndex = (direction === 'next') ? (currentIndex + 1) % filteredArticles.length : (currentIndex - 1 + filteredArticles.length) % filteredArticles.length;
Â  Â  Â  Â  Â  Â  displayArticle(filteredArticles[newIndex]);
Â  Â  Â  Â  }
Â  Â  Â  Â  function updateArticleCounter() {
Â  Â  Â  Â  Â  Â  const currentIndex = filteredArticles.indexOf(currentArticle);
Â  Â  Â  Â  Â  Â  document.getElementById('current-article-number').textContent = currentIndex + 1;
Â  Â  Â  Â  Â  Â  document.getElementById('total-articles').textContent = filteredArticles.length;
Â  Â  Â  Â  Â  Â  document.getElementById('current-date').textContent = currentArticle.DATE;
Â  Â  Â  Â  }

Â  Â  Â  Â  function setupSubNav() {
Â  Â  Â  Â  Â  Â  const subNavTabs = document.querySelectorAll('.sub-nav-tab');
Â  Â  Â  Â  Â  Â  const subPages = document.querySelectorAll('.sub-page');
Â  Â  Â  Â  Â  Â  subNavTabs.forEach(tab => {
Â  Â  Â  Â  Â  Â  Â  Â  tab.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  subNavTabs.forEach(t => t.classList.remove('active'));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tab.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const targetId = tab.dataset.target;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  subPages.forEach(page => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  page.classList.toggle('active', page.id === targetId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  _
